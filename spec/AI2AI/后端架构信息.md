# 企业内部福利商城 AI2AI - 后端架构信息

## 后端项目结构

```
backend/
├── src/
│   ├── config/           # 配置文件
│   │   ├── database.ts   # 数据库配置
│   │   └── constants.ts  # 常量配置
│   ├── services/         # 微服务
│   │   ├── user/         # 用户端服务
│   │   │   ├── controllers/    # 控制器
│   │   │   │   ├── auth.controller.ts        # 认证控制器
│   │   │   │   ├── product.controller.ts     # 商品控制器
│   │   │   │   ├── cart.controller.ts        # 购物车控制器
│   │   │   │   ├── order.controller.ts       # 订单控制器
│   │   │   │   ├── user.controller.ts        # 用户控制器
│   │   │   │   └── address.controller.ts     # 地址控制器
│   │   │   ├── services/       # 业务逻辑层
│   │   │   │   ├── auth.service.ts
│   │   │   │   ├── product.service.ts
│   │   │   │   ├── cart.service.ts
│   │   │   │   ├── order.service.ts
│   │   │   │   ├── user.service.ts
│   │   │   │   └── address.service.ts
│   │   │   ├── models/         # 数据模型
│   │   │   │   ├── user.model.ts
│   │   │   │   ├── product.model.ts
│   │   │   │   ├── cart.model.ts
│   │   │   │   ├── order.model.ts
│   │   │   │   └── address.model.ts
│   │   │   ├── routes/         # 路由定义
│   │   │   │   ├── auth.routes.ts
│   │   │   │   ├── product.routes.ts
│   │   │   │   ├── cart.routes.ts
│   │   │   │   ├── order.routes.ts
│   │   │   │   ├── user.routes.ts
│   │   │   │   └── address.routes.ts
│   │   │   └── index.ts        # 服务入口
│   │   └── admin/        # 管理员服务
│   │       ├── controllers/
│   │       │   ├── auth.controller.ts        # 管理员认证
│   │       │   ├── product.controller.ts     # 商品管理
│   │       │   ├── order.controller.ts       # 订单管理
│   │       │   ├── user.controller.ts        # 用户管理
│   │       │   ├── category.controller.ts    # 类别管理
│   │       │   └── statistics.controller.ts  # 统计报表
│   │       ├── services/
│   │       │   ├── auth.service.ts
│   │       │   ├── product.service.ts
│   │       │   ├── order.service.ts
│   │       │   ├── user.service.ts
│   │       │   ├── category.service.ts
│   │       │   └── statistics.service.ts
│   │       ├── models/
│   │       │   ├── admin.model.ts
│   │       │   ├── product.model.ts
│   │       │   ├── order.model.ts
│   │       │   ├── user.model.ts
│   │       │   └── category.model.ts
│   │       ├── routes/
│   │       │   ├── auth.routes.ts
│   │       │   ├── product.routes.ts
│   │       │   ├── order.routes.ts
│   │       │   ├── user.routes.ts
│   │       │   ├── category.routes.ts
│   │       │   └── statistics.routes.ts
│   │       └── index.ts        # 服务入口
│   ├── middleware/       # 中间件
│   │   ├── auth.ts       # 认证中间件
│   │   ├── error.ts      # 错误处理中间件
│   │   └── upload.ts     # 文件上传中间件
│   ├── utils/            # 工具函数
│   │   ├── jwt.ts        # JWT工具
│   │   ├── validator.ts  # 数据验证
│   │   └── response.ts   # 统一响应格式
│   ├── database/         # 数据库相关
│   │   ├── init.ts       # 数据库初始化
│   │   └── migrations/   # 数据库迁移
│   ├── types/            # TypeScript类型
│   └── app.ts            # Express应用入口
├── package.json
└── tsconfig.json
```

## 模块外部特性

### 配置模块 (config/)
- **database.ts**: 配置SQLite数据库连接
- **constants.ts**: 定义系统常量（角色、订单状态等）

### 用户端服务 (services/user/)
#### 控制器层 (controllers/)
- **auth.controller.ts**: 处理用户登录、登出请求
- **product.controller.ts**: 处理商品浏览、搜索、收藏请求
- **cart.controller.ts**: 处理购物车增删改查请求
- **order.controller.ts**: 处理订单创建、查询、取消请求
- **user.controller.ts**: 处理用户信息查询和更新请求
- **address.controller.ts**: 处理收货地址管理请求

#### 业务逻辑层 (services/)
- 实现核心业务逻辑，调用数据模型进行数据操作
- 处理积分计算、库存扣减等业务规则

#### 数据模型层 (models/)
- 定义与数据库表对应的数据模型
- 封装数据库CRUD操作

#### 路由层 (routes/)
- 定义RESTful API路由
- 关联路由与控制器

### 管理员服务 (services/admin/)
#### 控制器层 (controllers/)
- **auth.controller.ts**: 处理管理员登录、登出请求
- **product.controller.ts**: 处理商品增删改查、上下架请求
- **order.controller.ts**: 处理订单状态更新、查询请求
- **user.controller.ts**: 处理用户信息查询、积分调整请求
- **category.controller.ts**: 处理商品类别管理请求
- **statistics.controller.ts**: 处理统计数据查询请求

#### 业务逻辑层 (services/)
- 实现管理员端业务逻辑
- 处理数据统计、报表生成等功能

#### 数据模型层 (models/)
- 复用部分用户端服务的数据模型
- 定义管理员特有的数据模型

#### 路由层 (routes/)
- 定义管理员端API路由
- 实现权限控制

### 中间件模块 (middleware/)
- **auth.ts**: 验证JWT token，实现认证和授权
- **error.ts**: 统一错误处理和异常捕获
- **upload.ts**: 处理文件上传（商品图片、头像等）

### 工具函数模块 (utils/)
- **jwt.ts**: 生成和验证JWT token
- **validator.ts**: 请求数据验证
- **response.ts**: 统一API响应格式

### 数据库模块 (database/)
- **init.ts**: 初始化数据库，创建数据表
- **migrations/**: 数据库迁移脚本

### 应用入口 (app.ts)
- 配置Express应用
- 注册路由和中间件
- 启动服务监听

## 服务端口规划
- 用户端服务: 3001
- 管理员服务: 3002
