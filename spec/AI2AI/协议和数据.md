# 企业内部福利商城 AI2AI - 协议和数据

## 前后端通信协议

### API基础规范
- **通信协议**: HTTP/HTTPS
- **数据格式**: JSON
- **字符编码**: UTF-8
- **请求方式**: RESTful API

### 统一响应格式
```typescript
{
  success: boolean;      // 是否成功
  message: string;        // 响应消息
  data: any;             // 响应数据
  timestamp: number;     // 时间戳
}
```

### 认证方式
- **认证协议**: JWT (JSON Web Token)
- **Token位置**: HTTP请求头 Authorization: Bearer <token>
- **Token有效期**: 24小时

---

## 用户端API协议

### 认证相关

#### 用户登录
- **请求**: `POST /api/user/auth/login`
- **请求体**:
```typescript
{
  username: string;  // 用户名
  password: string;  // 密码
}
```
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    token: string;           // JWT token
    user: {
      id: number;
      username: string;
      name: string;
      department: string;
      position: string;
      email: string;
      phone: string;
      points: number;
      avatar?: string;
    };
  };
}
```

#### 用户登出
- **请求**: `POST /api/user/auth/logout`
- **响应**:
```typescript
{
  success: boolean;
  message: string;
}
```

### 商品相关

#### 获取商品列表
- **请求**: `GET /api/user/products`
- **查询参数**:
```typescript
{
  category?: string;      // 商品类别
  keyword?: string;       // 搜索关键词
  sortBy?: 'points' | 'sales' | 'createTime';  // 排序字段
  sortOrder?: 'asc' | 'desc';  // 排序方向
  page?: number;          // 页码
  pageSize?: number;      // 每页数量
}
```
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    list: Array<{
      id: number;
      name: string;
      description: string;
      category: string;
      images: string[];
      points: number;
      stock: number;
      sales: number;
      createTime: string;
      isFavorite?: boolean;  // 是否收藏
    }>;
    total: number;
    page: number;
    pageSize: number;
  };
}
```

#### 获取商品详情
- **请求**: `GET /api/user/products/:id`
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    id: number;
    name: string;
    description: string;
    specifications: string;  // 规格参数
    category: string;
    images: string[];
    points: number;
    stock: number;
    sales: number;
    createTime: string;
    exchangeNote: string;    // 兑换说明
    isFavorite?: boolean;
  };
}
```

#### 收藏/取消收藏商品
- **请求**: `POST /api/user/products/:id/favorite`
- **请求体**:
```typescript
{
  action: 'add' | 'remove';  // 添加或移除收藏
}
```

### 购物车相关

#### 获取购物车
- **请求**: `GET /api/user/cart`
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    items: Array<{
      id: number;
      productId: number;
      productName: string;
      productImage: string;
      points: number;
      quantity: number;
      subtotal: number;  // 小计积分
    }>;
    totalPoints: number;  // 总积分
  };
}
```

#### 添加到购物车
- **请求**: `POST /api/user/cart`
- **请求体**:
```typescript
{
  productId: number;
  quantity: number;
}
```

#### 更新购物车商品数量
- **请求**: `PUT /api/user/cart/:itemId`
- **请求体**:
```typescript
{
  quantity: number;
}
```

#### 删除购物车商品
- **请求**: `DELETE /api/user/cart/:itemId`

#### 批量删除购物车商品
- **请求**: `POST /api/user/cart/batch-delete`
- **请求体**:
```typescript
{
  itemIds: number[];
}
```

### 订单相关

#### 创建订单
- **请求**: `POST /api/user/orders`
- **请求体**:
```typescript
{
  cartItemIds: number[];  // 购物车商品ID列表
  addressId: number;      // 收货地址ID
}
```
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    orderId: number;
    orderNo: string;
    totalPoints: number;
  };
}
```

#### 获取订单列表
- **请求**: `GET /api/user/orders`
- **查询参数**:
```typescript
{
  status?: string;        // 订单状态
  keyword?: string;       // 搜索关键词
  startDate?: string;     // 开始日期
  endDate?: string;       // 结束日期
  page?: number;
  pageSize?: number;
}
```
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    list: Array<{
      id: number;
      orderNo: string;
      status: 'pending' | 'shipped' | 'completed' | 'cancelled';
      totalPoints: number;
      createTime: string;
      items: Array<{
        productName: string;
        productImage: string;
        quantity: number;
        points: number;
      }>;
    }>;
    total: number;
    page: number;
    pageSize: number;
  };
}
```

#### 获取订单详情
- **请求**: `GET /api/user/orders/:id`

#### 取消订单
- **请求**: `POST /api/user/orders/:id/cancel`

### 用户相关

#### 获取用户信息
- **请求**: `GET /api/user/profile`

#### 更新用户信息
- **请求**: `PUT /api/user/profile`
- **请求体**:
```typescript
{
  email?: string;
  phone?: string;
  avatar?: string;
}
```

#### 修改密码
- **请求**: `POST /api/user/profile/change-password`
- **请求体**:
```typescript
{
  oldPassword: string;
  newPassword: string;
}
```

#### 获取积分记录
- **请求**: `GET /api/user/points/history`
- **查询参数**:
```typescript
{
  type?: 'earn' | 'consume';  // 收入或消费
  page?: number;
  pageSize?: number;
}
```
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    list: Array<{
      id: number;
      type: 'earn' | 'consume';
      points: number;
      balance: number;        // 余额
      reason: string;        // 原因
      createTime: string;
    }>;
    total: number;
    page: number;
    pageSize: number;
  };
}
```

### 地址相关

#### 获取地址列表
- **请求**: `GET /api/user/addresses`

#### 添加地址
- **请求**: `POST /api/user/addresses`
- **请求体**:
```typescript
{
  receiver: string;       // 收货人
  phone: string;          // 手机号
  province: string;       // 省份
  city: string;           // 城市
  district: string;       // 区县
  detail: string;         // 详细地址
  isDefault: boolean;     // 是否默认
}
```

#### 更新地址
- **请求**: `PUT /api/user/addresses/:id`

#### 删除地址
- **请求**: `DELETE /api/user/addresses/:id`

#### 设置默认地址
- **请求**: `POST /api/user/addresses/:id/default`

---

## 管理员API协议

### 认证相关

#### 管理员登录
- **请求**: `POST /api/admin/auth/login`
- **请求体**:
```typescript
{
  username: string;
  password: string;
}
```
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    token: string;
    admin: {
      id: number;
      username: string;
      role: string;
    };
  };
}
```

### 商品管理相关

#### 获取商品列表
- **请求**: `GET /api/admin/products`
- **查询参数**: 同用户端，支持更多筛选条件

#### 添加商品
- **请求**: `POST /api/admin/products`
- **请求体**:
```typescript
{
  name: string;
  description: string;
  specifications: string;
  category: string;
  images: string[];
  points: number;
  stock: number;
  exchangeNote: string;
}
```

#### 更新商品
- **请求**: `PUT /api/admin/products/:id`

#### 删除商品
- **请求**: `DELETE /api/admin/products/:id`

#### 商品上下架
- **请求**: `POST /api/admin/products/:id/toggle-status`
- **请求体**:
```typescript
{
  status: 'active' | 'inactive';
}
```

#### 批量导入商品
- **请求**: `POST /api/admin/products/import`
- **请求体**: multipart/form-data，包含Excel文件

#### 导出商品列表
- **请求**: `GET /api/admin/products/export`

### 订单管理相关

#### 获取所有订单
- **请求**: `GET /api/admin/orders`
- **查询参数**: 支持按用户、时间、状态、商品筛选

#### 更新订单状态
- **请求**: `POST /api/admin/orders/:id/status`
- **请求体**:
```typescript
{
  status: 'pending' | 'shipped' | 'completed' | 'cancelled';
}
```

### 用户管理相关

#### 获取用户列表
- **请求**: `GET /api/admin/users`
- **查询参数**:
```typescript
{
  keyword?: string;      // 用户名、邮箱、手机号
  page?: number;
  pageSize?: number;
}
```

#### 获取用户详情
- **请求**: `GET /api/admin/users/:id`

#### 调整用户积分
- **请求**: `POST /api/admin/users/:id/points`
- **请求体**:
```typescript
{
  type: 'add' | 'deduct';  // 增加或扣减
  points: number;
  reason: string;
}
```

#### 用户状态管理
- **请求**: `POST /api/admin/users/:id/status`
- **请求体**:
```typescript
{
  status: 'active' | 'inactive';
}
```

### 类别管理相关

#### 获取类别列表
- **请求**: `GET /api/admin/categories`

#### 添加类别
- **请求**: `POST /api/admin/categories`
- **请求体**:
```typescript
{
  name: string;
  sort: number;  // 排序
}
```

#### 更新类别
- **请求**: `PUT /api/admin/categories/:id`

#### 删除类别
- **请求**: `DELETE /api/admin/categories/:id`

### 统计报表相关

#### 销售统计
- **请求**: `GET /api/admin/statistics/sales`
- **响应**:
```typescript
{
  success: boolean;
  message: string;
  data: {
    totalSales: number;
    totalOrders: number;
    topProducts: Array<{
      productId: number;
      productName: string;
      sales: number;
    }>;
    trend: Array<{
      date: string;
      sales: number;
    }>;
  };
}
```

#### 用户统计
- **请求**: `GET /api/admin/statistics/users`

#### 积分统计
- **请求**: `GET /api/admin/statistics/points`

#### 订单统计
- **请求**: `GET /api/admin/statistics/orders`

### 系统设置相关

#### 获取系统设置
- **请求**: `GET /api/admin/settings`

#### 更新系统设置
- **请求**: `PUT /api/admin/settings`
- **请求体**:
```typescript
{
  systemName?: string;
  announcement?: string;
  pointsRules?: string;
}
```

---

## 数据库设计

### 用户表 (users)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 用户ID | PRIMARY KEY, AUTOINCREMENT |
| username | VARCHAR(50) | 用户名 | UNIQUE, NOT NULL |
| password | VARCHAR(255) | 密码（加密） | NOT NULL |
| name | VARCHAR(50) | 姓名 | NOT NULL |
| department | VARCHAR(50) | 部门 | |
| position | VARCHAR(50) | 职位 | |
| email | VARCHAR(100) | 邮箱 | |
| phone | VARCHAR(20) | 手机号 | |
| points | INTEGER | 积分余额 | DEFAULT 0 |
| avatar | VARCHAR(255) | 头像URL | |
| status | VARCHAR(20) | 状态 | DEFAULT 'active' |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updateTime | DATETIME | 更新时间 | DEFAULT CURRENT_TIMESTAMP |

### 管理员表 (admins)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 管理员ID | PRIMARY KEY, AUTOINCREMENT |
| username | VARCHAR(50) | 用户名 | UNIQUE, NOT NULL |
| password | VARCHAR(255) | 密码（加密） | NOT NULL |
| role | VARCHAR(50) | 角色 | NOT NULL |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

### 商品表 (products)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 商品ID | PRIMARY KEY, AUTOINCREMENT |
| name | VARCHAR(100) | 商品名称 | NOT NULL |
| description | TEXT | 商品描述 | |
| specifications | TEXT | 规格参数 | |
| category | VARCHAR(50) | 商品类别 | NOT NULL |
| images | TEXT | 商品图片（JSON数组） | |
| points | INTEGER | 所需积分 | NOT NULL |
| stock | INTEGER | 库存数量 | DEFAULT 0 |
| sales | INTEGER | 销量 | DEFAULT 0 |
| exchangeNote | TEXT | 兑换说明 | |
| status | VARCHAR(20) | 状态 | DEFAULT 'active' |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updateTime | DATETIME | 更新时间 | DEFAULT CURRENT_TIMESTAMP |

### 商品类别表 (categories)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 类别ID | PRIMARY KEY, AUTOINCREMENT |
| name | VARCHAR(50) | 类别名称 | UNIQUE, NOT NULL |
| sort | INTEGER | 排序 | DEFAULT 0 |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

### 购物车表 (cart_items)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 购物车项ID | PRIMARY KEY, AUTOINCREMENT |
| userId | INTEGER | 用户ID | NOT NULL, FOREIGN KEY |
| productId | INTEGER | 商品ID | NOT NULL, FOREIGN KEY |
| quantity | INTEGER | 数量 | DEFAULT 1 |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| UNIQUE(userId, productId) | | |

### 订单表 (orders)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 订单ID | PRIMARY KEY, AUTOINCREMENT |
| orderNo | VARCHAR(50) | 订单号 | UNIQUE, NOT NULL |
| userId | INTEGER | 用户ID | NOT NULL, FOREIGN KEY |
| totalPoints | INTEGER | 总积分 | NOT NULL |
| status | VARCHAR(20) | 订单状态 | DEFAULT 'pending' |
| receiver | VARCHAR(50) | 收货人 | |
| phone | VARCHAR(20) | 手机号 | |
| address | TEXT | 收货地址 | |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updateTime | DATETIME | 更新时间 | DEFAULT CURRENT_TIMESTAMP |

### 订单商品表 (order_items)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 订单项ID | PRIMARY KEY, AUTOINCREMENT |
| orderId | INTEGER | 订单ID | NOT NULL, FOREIGN KEY |
| productId | INTEGER | 商品ID | NOT NULL, FOREIGN KEY |
| productName | VARCHAR(100) | 商品名称 | NOT NULL |
| productImage | VARCHAR(255) | 商品图片 | |
| points | INTEGER | 单价积分 | NOT NULL |
| quantity | INTEGER | 数量 | NOT NULL |

### 收货地址表 (addresses)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 地址ID | PRIMARY KEY, AUTOINCREMENT |
| userId | INTEGER | 用户ID | NOT NULL, FOREIGN KEY |
| receiver | VARCHAR(50) | 收货人 | NOT NULL |
| phone | VARCHAR(20) | 手机号 | NOT NULL |
| province | VARCHAR(50) | 省份 | NOT NULL |
| city | VARCHAR(50) | 城市 | NOT NULL |
| district | VARCHAR(50) | 区县 | NOT NULL |
| detail | TEXT | 详细地址 | NOT NULL |
| isDefault | BOOLEAN | 是否默认 | DEFAULT false |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

### 积分记录表 (point_records)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 记录ID | PRIMARY KEY, AUTOINCREMENT |
| userId | INTEGER | 用户ID | NOT NULL, FOREIGN KEY |
| type | VARCHAR(20) | 类型 | NOT NULL |
| points | INTEGER | 积分变化 | NOT NULL |
| balance | INTEGER | 余额 | NOT NULL |
| reason | VARCHAR(255) | 原因 | |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |

### 商品收藏表 (favorites)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 收藏ID | PRIMARY KEY, AUTOINCREMENT |
| userId | INTEGER | 用户ID | NOT NULL, FOREIGN KEY |
| productId | INTEGER | 商品ID | NOT NULL, FOREIGN KEY |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| UNIQUE(userId, productId) | | |

### 系统设置表 (system_settings)
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | INTEGER | 设置ID | PRIMARY KEY, AUTOINCREMENT |
| key | VARCHAR(50) | 键 | UNIQUE, NOT NULL |
| value | TEXT | 值 | |
| createTime | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updateTime | DATETIME | 更新时间 | DEFAULT CURRENT_TIMESTAMP |

---

## 初始化数据

### 测试用户
```sql
-- 普通用户
INSERT INTO users (username, password, name, department, position, email, phone, points) VALUES
('user1', '$2b$10$...', '张三', '技术部', '工程师', 'user1@company.com', '13800138001', 100),
('user2', '$2b$10$...', '李四', '市场部', '经理', 'user2@company.com', '13800138002', 200),
('user3', '$2b$10$...', '王五', '行政部', '专员', 'user3@company.com', '13800138003', 150);

-- 管理员
INSERT INTO admins (username, password, role) VALUES
('admin', '$2b$10$...', 'super_admin');
```

### 商品类别
```sql
INSERT INTO categories (name, sort) VALUES
('电子产品', 1),
('生活用品', 2),
('办公用品', 3),
('食品饮料', 4);
```
